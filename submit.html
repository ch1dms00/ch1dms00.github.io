<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ë¬¼í’ˆ ëŒ€ì—¬ ì‹ ì²­ì„œ</title>
  <style>
    body { font-family: 'Segoe UI'; background: #f3f0ff; }
    .form-container {
      width: 90%; max-width: 600px; margin: 30px auto;
      background-color: #f8f5ff; padding: 20px;
      border-radius: 10px; font-size: 14px; line-height: 1.8;
    }
    .form-container label { font-weight: 600; display: block; margin-top: 15px; margin-bottom: 5px; color: #333; }
    .form-container input, .form-container textarea {
      width: 100%; padding: 8px 10px; border: 1px solid #ccc;
      border-radius: 6px; font-size: 14px;
    }
    .form-container input[type="file"] { border: none; }
    .form-container button {
      margin-top: 25px; width: 100%; padding: 12px;
      background-color: #7b68ee; border: none; border-radius: 8px;
      color: white; font-size: 15px; font-weight: bold; cursor: pointer;
    }
    .form-container button:hover { background-color: #6656d1; }
    .back-btn {
      margin-top: 10px; display: block; text-align: center;
      background-color: #ccc; padding: 10px; border-radius: 8px;
      font-weight: bold; color: #333; text-decoration: none;
    }
  </style>
</head>
<body>
  <div class="form-container">
    <h2 style="text-align:center; color:#4a54e1;">ğŸ“„ ë¬¼í’ˆ ëŒ€ì—¬ ì‹ ì²­ì„œ</h2>

    <form id="rentalForm">
      <label for="department">ì†Œì†</label>
      <input type="text" id="department" required>

      <label for="grade">í•™ë²ˆ</label>
      <input type="text" id="grade" required>

      <label>ëŒ€í‘œì ì´ë¦„</label>
      <input type="text" name="repName" required>

      <label>ëŒ€í‘œì ì—°ë½ì²˜</label>
      <input type="text" name="repPhone" required>

      <label>ëŒ€ë¦¬ì¸ ì´ë¦„ (ì‹ ì²­ì ë³¸ì¸)</label>
      <input type="text" name="agentName">

      <label>ëŒ€ë¦¬ì¸ ì—°ë½ì²˜</label>
      <input type="text" name="agentPhone">

      <label for="place">ì‚¬ìš© ì¥ì†Œ</label>
      <input type="text" id="place" required>

      <label for="items">ëŒ€ì—¬ ë¬¼í’ˆ ë° ìˆ˜ëŸ‰</label>
      <textarea id="items" rows="3" required></textarea>

      <label for="rental-date">ëŒ€ì—¬ì¼ì</label>
      <input type="text" id="rental-date" required>

      <label for="return-date">ë°˜ë‚©ì¼ì</label>
      <input type="text" id="return-date" required>

      <label for="reason">ëŒ€ì—¬ ì‚¬ìœ </label>
      <textarea id="reason" rows="2"></textarea>

      <label for="note">ë¹„ê³ </label>
      <textarea id="note" rows="2"></textarea>

      <label for="file">íŒŒì¼ì²¨ë¶€ (ê³µì§€/ìŠ¤ìº”ë³¸ ë“±)</label>
      <input type="file" id="file" name="file">

      <button type="submit">ì‹ ì²­ì„œ ì œì¶œ</button>
    </form>

    <a href="rental_items.html" class="back-btn">ì´ì „ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
  </div>

  <script>
    // ëŒ€ì—¬ì¼/ë°˜ë‚©ì¼/ë¬¼í’ˆ ìë™ ì…ë ¥
    window.onload = function () {
      document.getElementById("rental-date").value = localStorage.getItem("rentalDate") || "";
      const returnDate = localStorage.getItem("returnDate") || "";
      const returnTime = localStorage.getItem("returnTime") || "";
      document.getElementById("return-date").value = returnDate + " " + returnTime;
      document.getElementById("items").value = localStorage.getItem("rentalItems") || "";
    };

    // í¼ ì œì¶œ ì´ë²¤íŠ¸
    document.getElementById('rentalForm').addEventListener('submit', function (e) {
      e.preventDefault();

      const data = {
        department: document.getElementById('department').value,
        grade: document.getElementById('grade').value,
        repName: document.getElementsByName('repName')[0].value,
        repPhone: document.getElementsByName('repPhone')[0].value,
        agentName: document.getElementsByName('agentName')[0].value,
        agentPhone: document.getElementsByName('agentPhone')[0].value,
        place: document.getElementById('place').value,
        items: document.getElementById('items').value,
        rentalDate: document.getElementById('rental-date').value,
        returnDate: document.getElementById('return-date').value,
        reason: document.getElementById('reason').value,
        note: document.getElementById('note').value
      };

      fetch('http://localhost:3000/api/rental', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify(data)
})
  .then(res => res.json())
  .then(res => {
    console.log('ì„œë²„ ì‘ë‹µ:', res);  // âœ… ì—¬ê¸° ì¤‘ìš”
    if (res.success) {
      location.href = 'submit_notice.html';
    } else {
      alert('âŒ ì €ì¥ ì‹¤íŒ¨ (ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜)');
    }
  })
  .catch(err => {
    console.error('âŒ fetch ì‹¤íŒ¨:', err);
    alert('âŒ ì €ì¥ ì‹¤íŒ¨: ' + err.message);
  });
  fetch('http://localhost:3000/api/rental', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify(data)
})
  .then(res => res.json())
  .then(res => {
    console.log('ì„œë²„ ì‘ë‹µ:', res);  // âœ… ì—¬ê¸° ì¤‘ìš”
    if (res.success) {
      location.href = 'submit_notice.html';
    } else {
      alert('âŒ ì €ì¥ ì‹¤íŒ¨ (ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜)');
    }
  })
  .catch(err => {
    console.error('âŒ fetch ì‹¤íŒ¨:', err);
    alert('âŒ ì €ì¥ ì‹¤íŒ¨: ' + err.message);
  });

})
</script>

</body>
</html>
