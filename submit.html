<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë¬¼í’ˆ ëŒ€ì—¬ ì‹ ì²­ì„œ</title>
  <style>
    body { font-family:'Segoe UI'; background:#f3f0ff; }
    .form-container{width:90%;max-width:600px;margin:30px auto;background:#f8f5ff;padding:20px;border-radius:10px;font-size:14px;line-height:1.8;}
    .form-container label{font-weight:600;display:block;margin-top:15px;margin-bottom:5px;color:#333;}
    .form-container input,.form-container textarea{width:100%;padding:8px 10px;border:1px solid #ccc;border-radius:6px;font-size:14px;}
    .form-container input[type="file"]{border:none;}
    .form-container button{margin-top:25px;width:100%;padding:12px;background:#7b68ee;border:none;border-radius:8px;color:#fff;font-size:15px;font-weight:bold;cursor:pointer;}
    .form-container button:hover{background:#6656d1;}
    .back-btn{margin-top:10px;display:block;text-align:center;background:#ccc;padding:10px;border-radius:8px;font-weight:bold;color:#333;text-decoration:none;}
  </style>
</head>
<body>
  <div class="form-container">
    <h2 style="text-align:center;color:#4a54e1;">ğŸ“„ ë¬¼í’ˆ ëŒ€ì—¬ ì‹ ì²­ì„œ</h2>

    <form id="rentalForm">
      <!-- ê¸°ë³¸ ì…ë ¥ -->
      <label for="department">ì†Œì†</label><input id="department" required>
      <label for="grade">í•™ë²ˆ</label><input id="grade" required>
      <label>ëŒ€í‘œì ì´ë¦„</label><input name="repName" required>
      <label>ëŒ€í‘œì ì—°ë½ì²˜</label><input name="repPhone" required>
      <label>ëŒ€ë¦¬ì¸ ì´ë¦„ (ì‹ ì²­ì ë³¸ì¸)</label><input name="agentName">
      <label>ëŒ€ë¦¬ì¸ ì—°ë½ì²˜</label><input name="agentPhone">
      <label for="place">ì‚¬ìš© ì¥ì†Œ</label><input id="place" required>
      <label for="items">ëŒ€ì—¬ ë¬¼í’ˆ ë° ìˆ˜ëŸ‰</label><textarea id="items" rows="3" required></textarea>
      <label for="rental-date">ëŒ€ì—¬ì¼ì</label><input id="rental-date" required>
      <label for="return-date">ë°˜ë‚©ì¼ì</label><input id="return-date" required>
      <label for="reason">ëŒ€ì—¬ ì‚¬ìœ </label><textarea id="reason" rows="2"></textarea>
      <label for="note">ë¹„ê³ </label><textarea id="note" rows="2"></textarea>

      <!-- â˜… ì²¨ë¶€ íŒŒì¼ -->
      <label for="file">íŒŒì¼ì²¨ë¶€ (ê³µì§€/ìŠ¤ìº”ë³¸ ë“±)</label>
      <input type="file" id="file">

      <button type="submit">ì‹ ì²­ì„œ ì œì¶œ</button>
    </form>

    <a href="rental_items.html" class="back-btn">ì´ì „ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
  </div>

  <script>
    /* ë‚ ì§œÂ·ë¬¼í’ˆ ìë™ ì±„ìš°ê¸° */
    window.onload = () => {
      document.getElementById('rental-date').value = localStorage.getItem('rentalDate') || '';
      const rd = localStorage.getItem('returnDate') || '';
      const rt = localStorage.getItem('returnTime') || '';
      document.getElementById('return-date').value = rd + ' ' + rt;
      document.getElementById('items').value = localStorage.getItem('rentalItems') || '';
    };

    /* â˜… File â†’ Base64 */
    const fileToBase64 = f => new Promise(res=>{
      const r=new FileReader(); r.onload=()=>res(r.result); r.readAsDataURL(f);
    });

    /* ì œì¶œ */
    document.getElementById('rentalForm').addEventListener('submit', async e=>{
      e.preventDefault();

      const data = {
        department : document.getElementById('department').value,
        grade      : document.getElementById('grade').value,
        repName    : document.getElementsByName('repName')[0].value,
        repPhone   : document.getElementsByName('repPhone')[0].value,
        agentName  : document.getElementsByName('agentName')[0].value,
        agentPhone : document.getElementsByName('agentPhone')[0].value,
        place      : document.getElementById('place').value,
        items      : document.getElementById('items').value,
        rentalDate : document.getElementById('rental-date').value,
        returnDate : document.getElementById('return-date').value,
        reason     : document.getElementById('reason').value,
        note       : document.getElementById('note').value
      };

      /* â˜… ì²¨ë¶€ íŒŒì¼ í¬í•¨ */
      const fInput = document.getElementById('file');
      if (fInput.files.length) {
        const file = fInput.files[0];
        data.fileName = file.name;
        data.fileData = await fileToBase64(file); // data:...;base64,...
      }

      /* (ì„ íƒ) ì„œë²„ ì „ì†¡ */
      fetch('http://localhost:3000/api/rental',{
        method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)
      })
      .then(r=>r.json()).then(r=>{
        if(!r.success) throw new Error('server error');
        /* ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì €ì¥ */
        const list = JSON.parse(localStorage.getItem('myRequests')||'[]');
        list.push(data);
        localStorage.setItem('myRequests',JSON.stringify(list));
        localStorage.setItem('myRepName',data.repName);
        location.href='submit_notice.html';
      })
      .catch(err=>alert('âŒ ì €ì¥ ì‹¤íŒ¨: '+err.message));
    });
  </script>
</body>
</html>

